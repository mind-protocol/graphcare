{
  "repo_path": "clients/scopelock/backend",
  "summary": {
    "total_files": 11,
    "total_functions": 37,
    "total_classes": 27,
    "total_imports": 77,
    "total_calls": 659
  },
  "files": {
    "clients/scopelock/backend/app/contracts.py": {
      "functions": [
        {
          "name": "validate_platform",
          "line_start": 68,
          "line_end": 72,
          "parameters": [
            "cls",
            "v"
          ],
          "return_type": "str",
          "decorators": [
            "field_validator",
            "classmethod"
          ],
          "is_async": false,
          "is_method": true,
          "parent_class": "LeadEvaluation",
          "calls": [
            "ValueError",
            "', '.join",
            "field_validator"
          ],
          "complexity": 2
        }
      ],
      "classes": [
        {
          "name": "UpworkResponseWebhook",
          "line_start": 16,
          "line_end": 21,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "body_html",
            "from_email",
            "received_at",
            "subject"
          ]
        },
        {
          "name": "ResponseDraftRequest",
          "line_start": 24,
          "line_end": 29,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "client",
            "job_link",
            "job_title",
            "message"
          ]
        },
        {
          "name": "ResponseDraft",
          "line_start": 32,
          "line_end": 39,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "client",
            "confidence",
            "draft_text",
            "job_title",
            "reasoning",
            "timestamp"
          ]
        },
        {
          "name": "ResponseDraftResult",
          "line_start": 42,
          "line_end": 47,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "action",
            "confidence",
            "message",
            "status"
          ]
        },
        {
          "name": "LeadEvaluation",
          "line_start": 54,
          "line_end": 72,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [
            "validate_platform"
          ],
          "attributes": [
            "budget",
            "decision",
            "link",
            "pain",
            "platform",
            "reason",
            "sent",
            "title",
            "urgency"
          ]
        },
        {
          "name": "LeadStats",
          "line_start": 75,
          "line_end": 81,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "go_count",
            "go_rate",
            "nogo_count",
            "sent_count",
            "total_evaluated"
          ]
        },
        {
          "name": "LeadTrackResult",
          "line_start": 84,
          "line_end": 89,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "go_rate",
            "message",
            "status",
            "total_evaluated"
          ]
        },
        {
          "name": "Event",
          "line_start": 96,
          "line_end": 100,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "event",
            "payload",
            "timestamp"
          ]
        },
        {
          "name": "EventQuery",
          "line_start": 103,
          "line_end": 107,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "event",
            "limit",
            "since"
          ]
        },
        {
          "name": "EventQueryResult",
          "line_start": 110,
          "line_end": 113,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "events",
            "total"
          ]
        },
        {
          "name": "TelegramCallback",
          "line_start": 120,
          "line_end": 124,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "action",
            "callback_id",
            "draft_id"
          ]
        },
        {
          "name": "TelegramCallbackResult",
          "line_start": 127,
          "line_end": 130,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "message",
            "status"
          ]
        },
        {
          "name": "ServiceStatus",
          "line_start": 137,
          "line_end": 140,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "last_check",
            "status"
          ]
        },
        {
          "name": "HealthCheckResult",
          "line_start": 143,
          "line_end": 148,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "services",
            "status",
            "timestamp",
            "uptime_seconds"
          ]
        },
        {
          "name": "ErrorResponse",
          "line_start": 155,
          "line_end": 160,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "code_location",
            "details",
            "error",
            "timestamp"
          ]
        }
      ],
      "imports": [
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": true
        },
        {
          "module": "typing",
          "names": [
            "Literal",
            "Optional"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": true
        },
        {
          "module": "pydantic",
          "names": [
            "BaseModel",
            "Field",
            "field_validator"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/webhooks.py": {
      "functions": [
        {
          "name": "upwork_webhook",
          "line_start": 72,
          "line_end": 123,
          "parameters": [
            "request"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "datetime.utcnow().isoformat",
            "datetime.utcnow",
            "logger.info",
            "runner.run_rafael",
            "logger.info",
            "logger.error",
            "logger.error",
            "router.post"
          ],
          "complexity": 3
        },
        {
          "name": "cloudmailin_webhook",
          "line_start": 127,
          "line_end": 220,
          "parameters": [
            "request"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "request.json",
            "data.get",
            "data.get",
            "data.get",
            "envelope.get",
            "headers.get",
            "logger.info",
            "from_address.lower",
            "logger.info",
            "subject.lower",
            "logger.info",
            "subject.replace('New message from', '').replace('on Upwork', '').strip",
            "subject.replace('New message from', '').replace",
            "subject.replace",
            "datetime.utcnow().isoformat",
            "datetime.utcnow",
            "logger.info",
            "runner.run_rafael",
            "logger.info",
            "logger.error",
            "logger.error",
            "router.post"
          ],
          "complexity": 5
        },
        {
          "name": "telegram_webhook",
          "line_start": 224,
          "line_end": 272,
          "parameters": [
            "update"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "logger.warning",
            "update.callback_query.get",
            "update.callback_query.get",
            "logger.info",
            "logger.warning",
            "callback_data.split",
            "action.startswith",
            "action.replace",
            "handle_proposal_action",
            "handle_approval",
            "logger.error",
            "router.post"
          ],
          "complexity": 5
        },
        {
          "name": "notify_draft",
          "line_start": 276,
          "line_end": 316,
          "parameters": [
            "draft_id",
            "client",
            "draft_text",
            "confidence",
            "received_at"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "logger.info",
            "send_draft_notification",
            "logger.error",
            "router.post"
          ],
          "complexity": 2
        },
        {
          "name": "notify_proposal",
          "line_start": 320,
          "line_end": 380,
          "parameters": [
            "proposal_id",
            "job_title",
            "job_url",
            "proposal_text",
            "bid_amount",
            "confidence",
            "client_spent",
            "client_rating",
            "client_hires",
            "client_payment_verified",
            "client_country",
            "client_rank"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "logger.info",
            "send_proposal_notification",
            "logger.error",
            "router.post"
          ],
          "complexity": 2
        },
        {
          "name": "vollna_webhook",
          "line_start": 384,
          "line_end": 457,
          "parameters": [
            "request"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "logger.info",
            "datetime.utcnow().isoformat",
            "datetime.utcnow",
            "request.headers.get",
            "logger.error",
            "JSONResponse",
            "base64.b64encode(f':{settings.webhook_secret}'.encode()).decode",
            "base64.b64encode",
            "f':{settings.webhook_secret}'.encode",
            "logger.error",
            "JSONResponse",
            "request.json",
            "data.get",
            "data.get",
            "logger.info",
            "len",
            "logger.warning",
            "asyncio.create_task",
            "process_vollna_project",
            "len",
            "logger.error",
            "str",
            "router.post"
          ],
          "complexity": 7
        },
        {
          "name": "process_vollna_project",
          "line_start": 460,
          "line_end": 530,
          "parameters": [
            "project",
            "payload"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "project.get('url', '').split",
            "project.get",
            "len",
            "datetime.utcnow().timestamp",
            "datetime.utcnow",
            "project.get",
            "urllib.parse.unquote",
            "upwork_url.split('url=')[1].split",
            "upwork_url.split",
            "project.get",
            "project.get('filters', [{}])[0].get",
            "project.get",
            "payload.get('filter', {}).get",
            "payload.get",
            "project.get",
            "client_details.get",
            "client_details.get",
            "client_details.get",
            "client_details.get",
            "(client_details.get('country') or {}).get",
            "client_details.get",
            "client_details.get",
            "project.get",
            "project.get",
            "project.get",
            "project.get",
            "', '.join",
            "project.get",
            "logger.info",
            "project.get",
            "runner.run_emma",
            "logger.info",
            "logger.error",
            "logger.error"
          ],
          "complexity": 11
        }
      ],
      "classes": [
        {
          "name": "UpworkWebhookRequest",
          "line_start": 31,
          "line_end": 36,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "client",
            "job_link",
            "job_title",
            "message"
          ]
        },
        {
          "name": "TelegramUpdate",
          "line_start": 39,
          "line_end": 42,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "callback_query",
            "update_id"
          ]
        },
        {
          "name": "CloudMailinWebhook",
          "line_start": 45,
          "line_end": 50,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "envelope",
            "headers",
            "html",
            "plain"
          ]
        },
        {
          "name": "VollnaWebhook",
          "line_start": 53,
          "line_end": 64,
          "bases": [
            "BaseModel"
          ],
          "decorators": [],
          "methods": [],
          "attributes": [
            "filter",
            "filters",
            "projects",
            "results_url",
            "total"
          ]
        }
      ],
      "imports": [
        {
          "module": "logging",
          "names": [
            "logging"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": false
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": true
        },
        {
          "module": "fastapi",
          "names": [
            "APIRouter",
            "Request",
            "Depends"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": true
        },
        {
          "module": "fastapi.responses",
          "names": [
            "JSONResponse"
          ],
          "alias": null,
          "line_number": 10,
          "is_from_import": true
        },
        {
          "module": "pydantic",
          "names": [
            "BaseModel"
          ],
          "alias": null,
          "line_number": 11,
          "is_from_import": true
        },
        {
          "module": "app.auth",
          "names": [
            "verify_webhook_signature"
          ],
          "alias": null,
          "line_number": 13,
          "is_from_import": true
        },
        {
          "module": "app.runner",
          "names": [
            "runner"
          ],
          "alias": null,
          "line_number": 14,
          "is_from_import": true
        },
        {
          "module": "app.telegram",
          "names": [
            "send_draft_notification",
            "handle_approval",
            "send_proposal_notification",
            "handle_proposal_action"
          ],
          "alias": null,
          "line_number": 15,
          "is_from_import": true
        },
        {
          "module": "app.config",
          "names": [
            "settings"
          ],
          "alias": null,
          "line_number": 408,
          "is_from_import": true
        },
        {
          "module": "base64",
          "names": [
            "base64"
          ],
          "alias": null,
          "line_number": 419,
          "is_from_import": false
        },
        {
          "module": "asyncio",
          "names": [
            "asyncio"
          ],
          "alias": null,
          "line_number": 441,
          "is_from_import": false
        },
        {
          "module": "app.config",
          "names": [
            "settings"
          ],
          "alias": null,
          "line_number": 408,
          "is_from_import": true
        },
        {
          "module": "base64",
          "names": [
            "base64"
          ],
          "alias": null,
          "line_number": 419,
          "is_from_import": false
        },
        {
          "module": "asyncio",
          "names": [
            "asyncio"
          ],
          "alias": null,
          "line_number": 441,
          "is_from_import": false
        },
        {
          "module": "urllib.parse",
          "names": [
            "urllib.parse"
          ],
          "alias": null,
          "line_number": 474,
          "is_from_import": false
        },
        {
          "module": "urllib.parse",
          "names": [
            "urllib.parse"
          ],
          "alias": null,
          "line_number": 474,
          "is_from_import": false
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/telegram.py": {
      "functions": [
        {
          "name": "__init__",
          "line_start": 25,
          "line_end": 35,
          "parameters": [
            "self",
            "token",
            "chat_id"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "TelegramBot",
          "calls": [],
          "complexity": 3
        },
        {
          "name": "send_message",
          "line_start": 37,
          "line_end": 78,
          "parameters": [
            "self",
            "text",
            "reply_markup"
          ],
          "return_type": "Optional[str]",
          "decorators": [],
          "is_async": true,
          "is_method": true,
          "parent_class": "TelegramBot",
          "calls": [
            "httpx.AsyncClient",
            "client.post",
            "response.raise_for_status",
            "response.json",
            "result.get",
            "str",
            "logger.info",
            "logger.error",
            "logger.error"
          ],
          "complexity": 4
        },
        {
          "name": "edit_message",
          "line_start": 80,
          "line_end": 123,
          "parameters": [
            "self",
            "message_id",
            "text",
            "reply_markup"
          ],
          "return_type": "bool",
          "decorators": [],
          "is_async": true,
          "is_method": true,
          "parent_class": "TelegramBot",
          "calls": [
            "httpx.AsyncClient",
            "client.post",
            "response.raise_for_status",
            "response.json",
            "result.get",
            "logger.info",
            "logger.error",
            "logger.error"
          ],
          "complexity": 4
        },
        {
          "name": "answer_callback",
          "line_start": 125,
          "line_end": 150,
          "parameters": [
            "self",
            "callback_id",
            "text"
          ],
          "return_type": "bool",
          "decorators": [],
          "is_async": true,
          "is_method": true,
          "parent_class": "TelegramBot",
          "calls": [
            "httpx.AsyncClient",
            "client.post",
            "response.raise_for_status",
            "response.json().get",
            "response.json",
            "logger.error"
          ],
          "complexity": 2
        },
        {
          "name": "send_draft_notification",
          "line_start": 161,
          "line_end": 237,
          "parameters": [
            "draft_id",
            "client",
            "draft_text",
            "confidence",
            "received_at"
          ],
          "return_type": "Optional[str]",
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "len",
            "bot.send_message",
            "draft_file.parent.mkdir",
            "datetime.utcnow().isoformat",
            "datetime.utcnow",
            "draft_file.write_text",
            "json.dumps",
            "logger.info",
            "logger.error"
          ],
          "complexity": 3
        },
        {
          "name": "send_proposal_notification",
          "line_start": 240,
          "line_end": 338,
          "parameters": [
            "proposal_id",
            "job_title",
            "job_url",
            "proposal_text",
            "bid_amount",
            "confidence",
            "client_info"
          ],
          "return_type": "Optional[str]",
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "client_info.get",
            "client_info.get",
            "client_info.get",
            "len",
            "len",
            "bot.send_message",
            "proposal_file.parent.mkdir",
            "datetime.utcnow().isoformat",
            "datetime.utcnow",
            "proposal_file.write_text",
            "json.dumps",
            "logger.info",
            "logger.error"
          ],
          "complexity": 3
        },
        {
          "name": "handle_proposal_action",
          "line_start": 341,
          "line_end": 427,
          "parameters": [
            "proposal_id",
            "action",
            "callback_id"
          ],
          "return_type": "dict",
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "proposal_file.exists",
            "logger.warning",
            "bot.answer_callback",
            "json.loads",
            "proposal_file.read_text",
            "datetime.utcnow().isoformat",
            "datetime.utcnow",
            "logger.info",
            "logger.warning",
            "proposal_file.write_text",
            "json.dumps",
            "proposal_data.get",
            "len",
            "bot.edit_message",
            "bot.answer_callback",
            "status_text.lower",
            "logger.info",
            "status_text.lower",
            "logger.error",
            "bot.answer_callback",
            "str"
          ],
          "complexity": 7
        },
        {
          "name": "handle_approval",
          "line_start": 430,
          "line_end": 538,
          "parameters": [
            "draft_id",
            "action",
            "callback_id"
          ],
          "return_type": "dict",
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "draft_file.exists",
            "logger.warning",
            "bot.answer_callback",
            "json.loads",
            "draft_file.read_text",
            "datetime.utcnow",
            "now.isoformat",
            "logger.warning",
            "draft_data['timestamps'].get",
            "datetime.fromisoformat",
            "(now - received_dt).total_seconds",
            "int",
            "logger.info",
            "draft_file.write_text",
            "json.dumps",
            "draft_data.get",
            "len",
            "bot.edit_message",
            "bot.answer_callback",
            "status_text.lower",
            "logger.info",
            "status_text.lower",
            "logger.error",
            "bot.answer_callback",
            "str"
          ],
          "complexity": 12
        }
      ],
      "classes": [
        {
          "name": "TelegramBot",
          "line_start": 18,
          "line_end": 150,
          "bases": [],
          "decorators": [],
          "methods": [
            "__init__",
            "send_message",
            "edit_message",
            "answer_callback"
          ],
          "attributes": [
            "api_base",
            "chat_id",
            "token"
          ]
        }
      ],
      "imports": [
        {
          "module": "json",
          "names": [
            "json"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": false
        },
        {
          "module": "logging",
          "names": [
            "logging"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": false
        },
        {
          "module": "pathlib",
          "names": [
            "Path"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": true
        },
        {
          "module": "typing",
          "names": [
            "Optional"
          ],
          "alias": null,
          "line_number": 10,
          "is_from_import": true
        },
        {
          "module": "httpx",
          "names": [
            "httpx"
          ],
          "alias": null,
          "line_number": 11,
          "is_from_import": false
        },
        {
          "module": "app.config",
          "names": [
            "settings"
          ],
          "alias": null,
          "line_number": 13,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 211,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 211,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 309,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 309,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 364,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 364,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 453,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 453,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/__init__.py": {
      "functions": [],
      "classes": [],
      "imports": [],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/browser_automation.py": {
      "functions": [
        {
          "name": "__init__",
          "line_start": 31,
          "line_end": 33,
          "parameters": [
            "self"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "UpworkProposalSubmitter",
          "calls": [
            "Path",
            "self.output_dir.mkdir"
          ],
          "complexity": 1
        },
        {
          "name": "submit_proposal",
          "line_start": 35,
          "line_end": 102,
          "parameters": [
            "self",
            "job_url",
            "proposal_text",
            "bid_amount",
            "connects_to_use"
          ],
          "return_type": "dict",
          "decorators": [],
          "is_async": true,
          "is_method": true,
          "parent_class": "UpworkProposalSubmitter",
          "calls": [
            "logger.info",
            "logger.error",
            "str"
          ],
          "complexity": 2
        },
        {
          "name": "check_login_status",
          "line_start": 104,
          "line_end": 118,
          "parameters": [
            "self"
          ],
          "return_type": "bool",
          "decorators": [],
          "is_async": true,
          "is_method": true,
          "parent_class": "UpworkProposalSubmitter",
          "calls": [
            "logger.error"
          ],
          "complexity": 2
        },
        {
          "name": "login_to_upwork",
          "line_start": 120,
          "line_end": 151,
          "parameters": [
            "self",
            "email",
            "password"
          ],
          "return_type": "bool",
          "decorators": [],
          "is_async": true,
          "is_method": true,
          "parent_class": "UpworkProposalSubmitter",
          "calls": [
            "logger.info",
            "logger.error"
          ],
          "complexity": 2
        }
      ],
      "classes": [
        {
          "name": "UpworkProposalSubmitter",
          "line_start": 23,
          "line_end": 151,
          "bases": [],
          "decorators": [],
          "methods": [
            "__init__",
            "submit_proposal",
            "check_login_status",
            "login_to_upwork"
          ],
          "attributes": [
            "output_dir"
          ]
        }
      ],
      "imports": [
        {
          "module": "logging",
          "names": [
            "logging"
          ],
          "alias": null,
          "line_number": 15,
          "is_from_import": false
        },
        {
          "module": "json",
          "names": [
            "json"
          ],
          "alias": null,
          "line_number": 16,
          "is_from_import": false
        },
        {
          "module": "pathlib",
          "names": [
            "Path"
          ],
          "alias": null,
          "line_number": 17,
          "is_from_import": true
        },
        {
          "module": "typing",
          "names": [
            "Optional"
          ],
          "alias": null,
          "line_number": 18,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/runner.py": {
      "functions": [
        {
          "name": "__init__",
          "line_start": 33,
          "line_end": 37,
          "parameters": [
            "self"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "ClaudeRunner",
          "calls": [
            "self._setup_credentials"
          ],
          "complexity": 1
        },
        {
          "name": "_setup_credentials",
          "line_start": 39,
          "line_end": 57,
          "parameters": [
            "self"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "ClaudeRunner",
          "calls": [
            "os.getenv",
            "logger.warning",
            "Path.home",
            "claude_dir.mkdir",
            "credentials_path.write_text",
            "logger.info",
            "logger.error"
          ],
          "complexity": 3
        },
        {
          "name": "run_rafael",
          "line_start": 59,
          "line_end": 84,
          "parameters": [
            "self",
            "client",
            "message",
            "job_title",
            "job_link",
            "received_at"
          ],
          "return_type": "dict",
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "ClaudeRunner",
          "calls": [
            "self._run_claude"
          ],
          "complexity": 1
        },
        {
          "name": "run_emma",
          "line_start": 86,
          "line_end": 111,
          "parameters": [
            "self",
            "job_post"
          ],
          "return_type": "dict",
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "ClaudeRunner",
          "calls": [
            "self._run_claude"
          ],
          "complexity": 1
        },
        {
          "name": "_run_claude",
          "line_start": 113,
          "line_end": 198,
          "parameters": [
            "self",
            "prompt",
            "citizen",
            "received_at"
          ],
          "return_type": "dict",
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "ClaudeRunner",
          "calls": [
            "logger.info",
            "logger.debug",
            "os.environ.copy",
            "Path",
            "Path",
            "claude_path.exists",
            "Path.home",
            "subprocess.run",
            "str",
            "str",
            "logger.info",
            "len",
            "len",
            "logger.error",
            "logger.error",
            "str",
            "logger.error"
          ],
          "complexity": 8
        }
      ],
      "classes": [
        {
          "name": "ClaudeRunner",
          "line_start": 19,
          "line_end": 198,
          "bases": [],
          "decorators": [],
          "methods": [
            "__init__",
            "_setup_credentials",
            "run_rafael",
            "run_emma",
            "_run_claude"
          ],
          "attributes": [
            "backend_api_url",
            "timeout"
          ]
        }
      ],
      "imports": [
        {
          "module": "logging",
          "names": [
            "logging"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": false
        },
        {
          "module": "subprocess",
          "names": [
            "subprocess"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": false
        },
        {
          "module": "json",
          "names": [
            "json"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": false
        },
        {
          "module": "os",
          "names": [
            "os"
          ],
          "alias": null,
          "line_number": 10,
          "is_from_import": false
        },
        {
          "module": "pathlib",
          "names": [
            "Path"
          ],
          "alias": null,
          "line_number": 11,
          "is_from_import": true
        },
        {
          "module": "typing",
          "names": [
            "Optional"
          ],
          "alias": null,
          "line_number": 12,
          "is_from_import": true
        },
        {
          "module": "app.config",
          "names": [
            "settings"
          ],
          "alias": null,
          "line_number": 14,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/main.py": {
      "functions": [
        {
          "name": "lifespan",
          "line_start": 31,
          "line_end": 55,
          "parameters": [
            "app"
          ],
          "return_type": null,
          "decorators": [
            "asynccontextmanager"
          ],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "logger.info",
            "logger.info",
            "settings.validate_required",
            "logger.info",
            "logger.error",
            "settings.data_dir.mkdir",
            "logger.info",
            "logger.info",
            "logger.info"
          ],
          "complexity": 3
        },
        {
          "name": "global_exception_handler",
          "line_start": 78,
          "line_end": 91,
          "parameters": [
            "request",
            "exc"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "logger.error",
            "ErrorResponse",
            "str",
            "JSONResponse",
            "error_response.model_dump",
            "app.exception_handler"
          ],
          "complexity": 1
        },
        {
          "name": "health_check",
          "line_start": 96,
          "line_end": 155,
          "parameters": [],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "int",
            "time.time",
            "test_file.write_text",
            "test_file.unlink",
            "ServiceStatus",
            "datetime.utcnow",
            "logger.error",
            "ServiceStatus",
            "datetime.utcnow",
            "ServiceStatus",
            "datetime.utcnow",
            "httpx.get",
            "ServiceStatus",
            "datetime.utcnow",
            "logger.debug",
            "ServiceStatus",
            "datetime.utcnow",
            "all",
            "services.values",
            "HealthCheckResult",
            "app.get"
          ],
          "complexity": 3
        },
        {
          "name": "root",
          "line_start": 160,
          "line_end": 170,
          "parameters": [],
          "return_type": null,
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "app.get"
          ],
          "complexity": 1
        }
      ],
      "classes": [],
      "imports": [
        {
          "module": "logging",
          "names": [
            "logging"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": false
        },
        {
          "module": "time",
          "names": [
            "time"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": false
        },
        {
          "module": "contextlib",
          "names": [
            "asynccontextmanager"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": true
        },
        {
          "module": "pathlib",
          "names": [
            "Path"
          ],
          "alias": null,
          "line_number": 10,
          "is_from_import": true
        },
        {
          "module": "fastapi",
          "names": [
            "FastAPI",
            "Request"
          ],
          "alias": null,
          "line_number": 12,
          "is_from_import": true
        },
        {
          "module": "fastapi.middleware.cors",
          "names": [
            "CORSMiddleware"
          ],
          "alias": null,
          "line_number": 13,
          "is_from_import": true
        },
        {
          "module": "fastapi.responses",
          "names": [
            "JSONResponse"
          ],
          "alias": null,
          "line_number": 14,
          "is_from_import": true
        },
        {
          "module": "app.config",
          "names": [
            "settings"
          ],
          "alias": null,
          "line_number": 16,
          "is_from_import": true
        },
        {
          "module": "app.contracts",
          "names": [
            "ErrorResponse"
          ],
          "alias": null,
          "line_number": 17,
          "is_from_import": true
        },
        {
          "module": "app.contracts",
          "names": [
            "HealthCheckResult",
            "ServiceStatus"
          ],
          "alias": null,
          "line_number": 102,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 103,
          "is_from_import": true
        },
        {
          "module": "httpx",
          "names": [
            "httpx"
          ],
          "alias": null,
          "line_number": 134,
          "is_from_import": false
        },
        {
          "module": "app.contracts",
          "names": [
            "HealthCheckResult",
            "ServiceStatus"
          ],
          "alias": null,
          "line_number": 102,
          "is_from_import": true
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 103,
          "is_from_import": true
        },
        {
          "module": "httpx",
          "names": [
            "httpx"
          ],
          "alias": null,
          "line_number": 134,
          "is_from_import": false
        },
        {
          "module": "app.webhooks",
          "names": [
            "router"
          ],
          "alias": null,
          "line_number": 174,
          "is_from_import": true
        },
        {
          "module": "uvicorn",
          "names": [
            "uvicorn"
          ],
          "alias": null,
          "line_number": 179,
          "is_from_import": false
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/database.py": {
      "functions": [
        {
          "name": "__repr__",
          "line_start": 45,
          "line_end": 46,
          "parameters": [
            "self"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "Event",
          "calls": [],
          "complexity": 1
        },
        {
          "name": "__repr__",
          "line_start": 64,
          "line_end": 65,
          "parameters": [
            "self"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "Draft",
          "calls": [],
          "complexity": 1
        },
        {
          "name": "__repr__",
          "line_start": 84,
          "line_end": 85,
          "parameters": [
            "self"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "Lead",
          "calls": [],
          "complexity": 1
        },
        {
          "name": "init_db",
          "line_start": 92,
          "line_end": 94,
          "parameters": [],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "Base.metadata.create_all"
          ],
          "complexity": 1
        },
        {
          "name": "get_db",
          "line_start": 97,
          "line_end": 111,
          "parameters": [],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "SessionLocal",
            "db.close"
          ],
          "complexity": 1
        }
      ],
      "classes": [
        {
          "name": "Event",
          "line_start": 36,
          "line_end": 46,
          "bases": [
            "Base"
          ],
          "decorators": [],
          "methods": [
            "__repr__"
          ],
          "attributes": [
            "__tablename__",
            "event",
            "id",
            "payload",
            "timestamp"
          ]
        },
        {
          "name": "Draft",
          "line_start": 49,
          "line_end": 65,
          "bases": [
            "Base"
          ],
          "decorators": [],
          "methods": [
            "__repr__"
          ],
          "attributes": [
            "__tablename__",
            "client",
            "confidence",
            "created_at",
            "draft_text",
            "id",
            "job_title",
            "message",
            "status",
            "telegram_message_id",
            "updated_at"
          ]
        },
        {
          "name": "Lead",
          "line_start": 68,
          "line_end": 85,
          "bases": [
            "Base"
          ],
          "decorators": [],
          "methods": [
            "__repr__"
          ],
          "attributes": [
            "__tablename__",
            "budget",
            "created_at",
            "decision",
            "id",
            "link",
            "pain",
            "platform",
            "reason",
            "sent",
            "title",
            "urgency"
          ]
        }
      ],
      "imports": [
        {
          "module": "os",
          "names": [
            "os"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": false
        },
        {
          "module": "datetime",
          "names": [
            "datetime"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": true
        },
        {
          "module": "sqlalchemy",
          "names": [
            "create_engine",
            "Column",
            "Integer",
            "String",
            "DateTime",
            "JSON",
            "Text",
            "Boolean"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": true
        },
        {
          "module": "sqlalchemy.ext.declarative",
          "names": [
            "declarative_base"
          ],
          "alias": null,
          "line_number": 10,
          "is_from_import": true
        },
        {
          "module": "sqlalchemy.orm",
          "names": [
            "sessionmaker"
          ],
          "alias": null,
          "line_number": 11,
          "is_from_import": true
        },
        {
          "module": "app.config",
          "names": [
            "settings"
          ],
          "alias": null,
          "line_number": 13,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/auth.py": {
      "functions": [
        {
          "name": "verify_webhook_signature",
          "line_start": 17,
          "line_end": 55,
          "parameters": [
            "request",
            "x_webhook_signature"
          ],
          "return_type": "bool",
          "decorators": [],
          "is_async": true,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "Header",
            "request.body",
            "settings.webhook_secret.encode",
            "hmac.new(secret, body, hashlib.sha256).hexdigest",
            "hmac.new",
            "hmac.compare_digest",
            "logger.warning",
            "HTTPException",
            "logger.info"
          ],
          "complexity": 2
        },
        {
          "name": "generate_webhook_signature",
          "line_start": 58,
          "line_end": 76,
          "parameters": [
            "payload"
          ],
          "return_type": "str",
          "decorators": [],
          "is_async": false,
          "is_method": false,
          "parent_class": null,
          "calls": [
            "settings.webhook_secret.encode",
            "hmac.new(secret, payload.encode(), hashlib.sha256).hexdigest",
            "hmac.new",
            "payload.encode"
          ],
          "complexity": 1
        }
      ],
      "classes": [],
      "imports": [
        {
          "module": "hmac",
          "names": [
            "hmac"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": false
        },
        {
          "module": "hashlib",
          "names": [
            "hashlib"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": false
        },
        {
          "module": "logging",
          "names": [
            "logging"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": false
        },
        {
          "module": "fastapi",
          "names": [
            "Header",
            "HTTPException",
            "Request"
          ],
          "alias": null,
          "line_number": 10,
          "is_from_import": true
        },
        {
          "module": "app.config",
          "names": [
            "settings"
          ],
          "alias": null,
          "line_number": 12,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/config.py": {
      "functions": [
        {
          "name": "validate_required",
          "line_start": 40,
          "line_end": 57,
          "parameters": [
            "self"
          ],
          "return_type": null,
          "decorators": [],
          "is_async": false,
          "is_method": true,
          "parent_class": "Settings",
          "calls": [
            "missing.append",
            "missing.append",
            "missing.append",
            "ValueError",
            "', '.join",
            "self.data_dir.mkdir"
          ],
          "complexity": 6
        }
      ],
      "classes": [
        {
          "name": "Settings",
          "line_start": 13,
          "line_end": 57,
          "bases": [
            "BaseSettings"
          ],
          "decorators": [],
          "methods": [
            "validate_required"
          ],
          "attributes": [
            "backend_api_url",
            "citizen_runner_url",
            "data_dir",
            "environment",
            "log_level",
            "port",
            "telegram_bot_token",
            "telegram_chat_id",
            "webhook_secret",
            "workers"
          ]
        },
        {
          "name": "Config",
          "line_start": 36,
          "line_end": 38,
          "bases": [],
          "decorators": [],
          "methods": [],
          "attributes": [
            "case_sensitive",
            "env_file"
          ]
        }
      ],
      "imports": [
        {
          "module": "os",
          "names": [
            "os"
          ],
          "alias": null,
          "line_number": 7,
          "is_from_import": false
        },
        {
          "module": "pathlib",
          "names": [
            "Path"
          ],
          "alias": null,
          "line_number": 8,
          "is_from_import": true
        },
        {
          "module": "typing",
          "names": [
            "Literal"
          ],
          "alias": null,
          "line_number": 9,
          "is_from_import": true
        },
        {
          "module": "pydantic_settings",
          "names": [
            "BaseSettings"
          ],
          "alias": null,
          "line_number": 10,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    },
    "clients/scopelock/backend/app/api/__init__.py": {
      "functions": [],
      "classes": [],
      "imports": [
        {
          "module": "app.api",
          "names": [
            "drafts",
            "events",
            "webhooks"
          ],
          "alias": null,
          "line_number": 5,
          "is_from_import": true
        }
      ],
      "parse_errors": []
    }
  }
}